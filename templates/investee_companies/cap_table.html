{% extends 'base.html' %}
{% block title %}Cap Table • {{ company.name }}{% endblock %}

{% block content %}
<div class="space-y-8">
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
            <a href="{% url 'investee_companies:portal-detail' company.pk %}" class="w-10 h-10 flex items-center justify-center bg-white rounded-xl shadow-sm text-secondary hover:text-primary border border-slate-100 transition">
                <i class="bi bi-arrow-left"></i>
            </a>
            <h1 class="text-2xl font-bold text-dark tracking-tight">Capitalization Table</h1>
        </div>
        <a href="{% url 'investee_companies:add-shareholding' company.pk %}" class="bg-primary text-white px-5 py-2.5 rounded-xl font-bold shadow-lg shadow-primary/20 hover:bg-indigo-700 transition text-xs">
            <i class="bi bi-plus-lg mr-1"></i> Register Shareholder
        </a>
    </div>

    <div class="space-y-10">
        {% for sc_id, class_data in grouped.items %}
        <div class="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
            <div class="px-8 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                <h2 class="font-bold text-indigo-700 text-sm uppercase tracking-widest">{{ class_data.label }}</h2>
                <div class="text-xs text-secondary">
                    Total Pool: <span class="font-black text-dark">{{ class_data.total_units|floatformat:0 }} Units</span>
                </div>
            </div>
            
            <table class="w-full text-left text-sm">
                <thead class="bg-slate-50/30 text-secondary text-[10px] font-black uppercase tracking-widest border-b border-slate-100">
                    <tr>
                        <th class="px-8 py-4">Shareholder Name</th>
                        <th class="px-8 py-4 text-right">Units Held</th>
                        <th class="px-8 py-4 text-right">Face Value</th>
                        <th class="px-8 py-4 text-right">% of Class</th>
                        <th class="px-8 py-4 text-right">% of Company</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-50">
                    {% for row in class_data.rows %}
                    <tr class="{% if row.is_residual %}bg-indigo-50/30 italic{% else %}hover:bg-slate-50/50{% endif %}">
                        <td class="px-8 py-4">
                            <div class="flex items-center">
                                {% if row.is_residual %}
                                <i class="bi bi-people-fill text-indigo-400 mr-2"></i>
                                {% else %}
                                <i class="bi bi-person-circle text-slate-300 mr-2"></i>
                                {% endif %}
                                <span class="font-bold {% if row.is_residual %}text-indigo-600{% else %}text-dark{% endif %}">{{ row.holder }}</span>
                            </div>
                        </td>
                        <td class="px-8 py-4 text-right font-mono">{{ row.number_of_shares|floatformat:0 }}</td>
                        <td class="px-8 py-4 text-right text-secondary font-mono">₹{{ row.total_face_value|floatformat:2 }}</td>
                        <td class="px-8 py-4 text-right font-black text-dark">{{ row.percent_of_class|floatformat:2 }}%</td>
                        <td class="px-8 py-4 text-right text-secondary">{{ row.percent_of_total|floatformat:2 }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="bg-slate-50 font-bold text-dark border-t border-slate-100">
                    <tr>
                        <td class="px-8 py-4 uppercase text-[10px] tracking-widest">Total Class Pool</td>
                        <td class="px-8 py-4 text-right">{{ class_data.total_units|floatformat:0 }}</td>
                        <td class="px-8 py-4 text-right">₹{{ class_data.total_face_value|floatformat:2 }}</td>
                        <td class="px-8 py-4 text-right">100.00%</td>
                        <td class="px-8 py-4 text-right">---</td>
                    </tr>
                </tfoot>
            </table>
        </div>
        {% endfor %}
    </div>

    <div class="bg-indigo-600 rounded-3xl p-8 text-white shadow-xl shadow-indigo-100 flex flex-col md:flex-row items-center justify-between gap-6">
        <div>
            <h3 class="text-xl font-bold">Consolidated Portfolio Total</h3>
            <p class="text-indigo-100 text-sm mt-1">Sum of all master instrument pools for this entity.</p>
        </div>
        <div class="text-right">
            <div class="text-[10px] font-black uppercase tracking-widest opacity-60">Total Outstanding Units</div>
            <div class="text-4xl font-black">{{ grand_total_pool|floatformat:0 }}</div>
        </div>
    </div>
</div>
{% endblock %}