{% extends 'base.html' %}

{% block title %}{{ title|default:"Investor Profile" }} | AIF Portal{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-black text-slate-900 tracking-tight">{{ title|default:"Investor Management" }}</h1>
        <p class="text-slate-500 text-sm font-medium mt-1">
            Ensure all KYC details match the official PAN/Aadhar records.
        </p>
    </div>

    <div class="bg-white p-8 rounded-3xl border border-slate-200 shadow-xl shadow-slate-200/50">
        <form method="post" class="space-y-8">
            {% csrf_token %}
            
{% if form.errors %}
<div class="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-r-xl">
    <h3 class="font-bold text-red-800 text-sm mb-2">Form Validation Errors:</h3>
    <ul class="list-disc pl-5 text-xs text-red-600 space-y-1">
        {% for field in form %}
            {% if field.errors %}
                <li>
                    <span class="font-bold uppercase">{{ field.label }}:</span> 
                    {{ field.errors|striptags }}
                </li>
            {% endif %}
        {% endfor %}
        
        {% for error in form.non_field_errors %}
            <li><span class="font-bold uppercase">General:</span> {{ error }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

            <div>
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 border-b border-slate-100 pb-2">
                    Identity & Classification
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-1.5">Legal Name</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <p class="text-xs text-rose-500 mt-1 font-bold">{{ form.name.errors.0 }}</p>
                        {% endif %}
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-1.5">Entity Type</label>
                        {{ form.investor_type }}
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-1.5">PAN Number</label>
                        {{ form.pan }}
                        <p class="text-[10px] text-slate-400 mt-1">Mandatory for Tax Reporting</p>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-1.5">Accreditation Status</label>
                        {{ form.accreditation_status|default:form.accreditation_status }} 
                        </div>
                </div>
            </div>

            <div>
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 border-b border-slate-100 pb-2">
                    Contact Details
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-1.5">Official Email</label>
                        {{ form.email }}
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-1.5">Phone / Mobile</label>
                        {{ form.phone }}
                    </div>
                </div>
            </div>
            
            <div>
                 <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4 border-b border-slate-100 pb-2">
                    Manager Association
                </h3>
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Linked Manager Entities</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                        {{ form.manager_entities }}
                    </div>
                    <p class="text-[10px] text-slate-400 mt-2">
                        Select which Investment Manager entities manage this investor's capital.
                    </p>
                </div>
            </div>

            <div class="pt-6 border-t border-slate-100 flex items-center justify-end gap-3">
                <a href="{% url 'investors:portal-list' %}" class="px-6 py-3 rounded-xl text-slate-600 font-bold hover:bg-slate-50 transition-all text-sm">
                    Cancel
                </a>
                <button type="submit" class="bg-indigo-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all text-sm flex items-center gap-2">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    {{ button_text|default:"Save Profile" }}
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Simple script to apply Tailwind classes to default Django widgets
    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.querySelectorAll('input[type="text"], input[type="email"], select');
        inputs.forEach(input => {
            if (!input.classList.contains('w-full')) {
                input.classList.add('w-full', 'p-3', 'bg-slate-50', 'border', 'border-slate-200', 'rounded-xl', 'text-sm', 'font-medium', 'text-slate-700', 'focus:ring-2', 'focus:ring-indigo-500', 'focus:border-indigo-500', 'outline-none', 'transition-all');
            }
        });
        
        // Fix Checkbox lists for Manager Entities
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(box => {
            box.classList.add('w-4', 'h-4', 'text-indigo-600', 'rounded', 'border-slate-300', 'focus:ring-indigo-500');
        });
    });
</script>
{% endblock %}