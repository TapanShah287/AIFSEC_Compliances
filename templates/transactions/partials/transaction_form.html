<body class="bg-light"><div class="container py-4"><!doctype html><html><head>
<!-- Added by automated fixer: Bootstrap 5 + meta -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-2dyVtHcYq4uW6GfBa6XJgkv1z0uM8sF+K2QGm0Cw8C0fM3Zf3Q8pQ0G3qE3rj1YL" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head><!-- templates/transactions/transaction_form.html -->
{% extends "base.html" %}
{% block title %}Add {{ type }} Transaction{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold mb-6">Add {{ type }} Transaction for {{ fund.name }}</h1>

<div class="mb-4">
  <a href="{% url 'fund_detail' fund.pk %}" class="px-3 py-2 text-sm border rounded-lg hover:bg-slate-100">← Back to Fund</a>
</div>

<form method="post" id="transactionForm" class="bg-white shadow rounded-lg p-6" data-share-types-url="{% url 'transactions:ajax_load_share_types' %}" data-face-value-url="{% url 'transactions:ajax_get_face_value' %}">
  {% csrf_token %}
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Left Column -->
    <div>
      <label for="id_investee_company" class="block text-sm font-medium text-gray-700">Investee Company Name</label>
      {{ form.investee_company }}
    </div>
    <div>
      <label for="id_share_type" class="block text-sm font-medium text-gray-700">Type of Shares</label>
      {{ form.share_type }}
    </div>
    <div>
      <label for="id_quantity" class="block text-sm font-medium text-gray-700">Qty of Shares</label>
      {{ form.quantity }}
    </div>
    
    <!-- Right Column -->
    <div>
      <label for="id_purchase_rate" class="block text-sm font-medium text-gray-700">Purchase Rate</label>
      {{ form.purchase_rate }}
    </div>
    <div>
      <label for="id_face_value" class="block text-sm font-medium text-gray-700">Face Value</label>
      {{ form.face_value }}
    </div>
    <div>
      <label for="id_purchase_date" class="block text-sm font-medium text-gray-700">Purchase Date</label>
      {{ form.purchase_date }}
    </div>
  </div>
  
  <div class="mt-8 border-t pt-5">
    <h3 class="text-lg font-medium text-gray-900">Total Purchase Consideration</h3>
    <p id="totalConsideration" class="text-2xl font-bold text-indigo-600 mt-1">₹0.00</p>
  </div>

  <div class="mt-6">
    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg shadow text-sm">Save Transaction</button>
  </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const companySelect = document.getElementById('id_investee_company');
    const shareTypeSelect = document.getElementById('id_share_type');
    const faceValueInput = document.getElementById('id_face_value');
    const quantityInput = document.getElementById('id_quantity');
    const rateInput = document.getElementById('id_purchase_rate');
    const totalConsideration = document.getElementById('totalConsideration');
    const form = document.getElementById('transactionForm');

    if (companySelect) {
        companySelect.addEventListener('change', function() {
            const companyId = this.value;
            if (companyId) {
                const url = form.dataset.shareTypesUrl + '?company_id=' + companyId;
                fetch(url)
                    .then(response => response.text())
                    .then(data => {
                        if (shareTypeSelect) {
                            shareTypeSelect.innerHTML = data;
                        }
                        if (faceValueInput) {
                            faceValueInput.value = '';
                        }
                    });
            }
        });
    }

    if (shareTypeSelect) {
        shareTypeSelect.addEventListener('change', function() {
            const shareTypeId = this.value;
            if (shareTypeId) {
                const url = form.dataset.faceValueUrl + '?share_type_id=' + shareTypeId;
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (faceValueInput) {
                            faceValueInput.value = data.face_value;
                        }
                    });
            } else {
                if (faceValueInput) {
                    faceValueInput.value = '';
                }
            }
        });
    }

    function updateTotal() {
        const quantity = parseFloat(quantityInput.value) || 0;
        const rate = parseFloat(rateInput.value) || 0;
        const total = quantity * rate;
        if (totalConsideration) {
            totalConsideration.textContent = '₹' + total.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }
    }

    if (quantityInput) {
        quantityInput.addEventListener('input', updateTotal);
    }
    if (rateInput) {
        rateInput.addEventListener('input', updateTotal);
    }
});
</script>
{% endblock %}</div><!-- Added by automated fixer: Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1k2cbn6hQYQW3xw2VbX9kC9o7bT8o6yC5dYF6q0bYkI3yXl9hKxZ+o5uS7Jj9Lx" crossorigin="anonymous"></script>
</body>